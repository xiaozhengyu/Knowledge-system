# WebSocket

[toc]

## WebSocket

### 概念

WebSocket是一种在单个<mark>TCP</mark>连接上进行<mark>全双工</mark>通信的协议。

WebSocket使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在WebSocket API中，浏览器和服务器只需要完成<mark>一次握手</mark>，两者之间就直接可以创建持久性的连接，并进行双向数据传输。

>   为了创建Websocket连接，需要通过浏览器发出请求，之后服务器进行回应，这个过程通常称为“握手”（handshaking）。

### 背景

轮询的替代方案：

为了获取实时信息，很多网站采用的技术都是<mark>轮询</mark>。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出<mark>HTTP</mark>请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的<mark>头部</mark>，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源。 

这种情况下，HTML5定义了WebSocket协议。

### 优点

-   较少的控制开销：与HTTP不同的是，Websocket需要先创建连接，这就使得其成为一种有状态的协议，之后通信时可以省略部分状态信息。而HTTP请求可能需要在每个请求都携带状态信息（如身份认证等）。在连接创建后，服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。相对于HTTP请求每次都要携带完整的头部，此项开销显著减少了。
-   更好的消息实时性：由于协议是全双工的，所以服务器可以随时主动给客户端下发数据。相对于HTTP请求需要等待客户端发起请求服务端才能响应，延迟明显更少。

## WebSocket和HTTP

### 相同点

-   都基于TCP，都是可靠性传输协议
-   都是应用层协议

### 不同点

-   WebSocket是双向的，http是单向的

### 联系

WebSocket在建立握手时，数据是通过HTTP传输的。但是建立之后，在真正传输时候是不需要HTTP协议的。



## WebSocket和Socket

Socket是传输控制层协议，WebSocket是应用层协议。

