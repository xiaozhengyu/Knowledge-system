# Hystrix 理论

[toc]

## 服务雪崩|故障蔓延

假设存在如下调用链：

![image-20220226224517025](markdown/Hystrix 理论.assets/image-20220226224517025.png)

当`Service C`变得不可用，`Service B` 对 `Sercice C`的请求就会阻塞，`Service B`的线程资源就会逐渐被耗尽。紧接着，`Service A`对`Service B`的请求也会被阻塞，`Service A`的线程资源也会逐渐被耗尽。这一过程如下图所示：

![image-20220226224540932](markdown/Hystrix 理论.assets/image-20220226224540932.png)

在上述问题中，最初出现故障的只有`Service C`，但最终却导致了整条链路上所有服务都出现孤战的情况，通常我们称之为故障蔓延或服务雪崩。

对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示<u>需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统</u>。

## 服务降级、熔断、限流

服务降级、服务熔断、服务限流是解决服务雪崩问题的常用手段

-   **服务降级**：站在全局的角度，当系统资源出现紧张，牺牲部分非核心功能，优先保障核心功能——弃卒保帅

    “牺牲部分非核心功能”的意思是，降低功能的质量，或者停止该功能，例如，将强一致性改为最终一致性。

-   **服务熔断**：在外部接口可能出现问题的情况下，暂时停止对外部接口的调用

    给外部接口一个喘息的机会，避免外部接口被直接打死

    “外部接口可能出现问题”的依据通常是响应速度、请求成功率等

-   **服务限流**：当请求总量或者一段时间内的请求数量超过设定的阈值，直接拒绝新的请求

## Hystrix 简介

Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等。<u>Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</u>

<(￣︶￣)↗[官方使用指导手册](https://github.com/Netflix/Hystrix/wiki/How-To-Use)

非常遗憾，目前 Hystrix 项目已经进入停更状态：

![image-20220226232342527](markdown/Hystrix 理论.assets/image-20220226232342527.png)
